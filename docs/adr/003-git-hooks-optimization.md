# ADR-003: Git Hooks å„ªåŒ–ç­–ç•¥

---

title: Git Hooks å„ªåŒ– - Pre-commit é€Ÿåº¦èˆ‡ Pre-push é©—è­‰
type: adr
status: accepted
date: 2025-11-05
deciders: [Henry Lee]
consulted: [æ¥­ç•Œç ”ç©¶ã€é–‹æºå°ˆæ¡ˆ]
informed: [é–‹ç™¼åœ˜éšŠ]
supersedes: null
superseded_by: null
tags: [git, hooks, typescript, performance, developer-experience]
related:

- explanation/git-hooks-research.md
- reference/git-hooks.md
- reference/commitlint-rules.md
- guides/git-workflow.md
  ai_context: |
  æŠ€è¡“æ±ºç­–è¨˜éŒ„ï¼šé€éå¾ pre-commit ç§»é™¤ TypeScript æª¢æŸ¥ã€å¯¦ä½œå…¨é¢çš„ pre-push é©—è­‰ã€
  æ–°å¢ commitlintï¼Œä»¥åŠå¼·åˆ¶åŸ·è¡Œ commit å¤§å°é™åˆ¶ä¾†å„ªåŒ– git hooksã€‚

---

## ç‹€æ…‹

**å·²æ¥å—**

- æè­°æ—¥æœŸï¼š2025-11-05
- æ¥å—æ—¥æœŸï¼š2025-11-05
- å¯¦ä½œæ—¥æœŸï¼š2025-11-05

## èƒŒæ™¯

**æˆ‘å€‘é¢è‡¨çš„è­°é¡Œæˆ–å•é¡Œæ˜¯ä»€éº¼ï¼Ÿ**

åœ¨å¯¦ä½œ Issue #23ï¼ˆçµæ§‹åŒ–æ—¥èªŒç³»çµ±ï¼‰æœŸé–“ï¼Œæˆ‘å€‘çš„ git hooks å·¥ä½œæµç¨‹å‡ºç¾äº†å¹¾å€‹é—œéµå•é¡Œï¼š

### å•é¡Œ 1ï¼šPre-commit æ•ˆèƒ½

**ç¾æ³**ï¼š

- Pre-commit hook å°æ•´å€‹å°ˆæ¡ˆåŸ·è¡Œ `tsc --noEmit`
- æ¯æ¬¡ commit éœ€è¦ 8-15 ç§’
- é–‹ç™¼è€…å° commit é€Ÿåº¦è¡¨ç¤ºä¸æ»¿
- éƒ¨åˆ†é–‹ç™¼è€…è€ƒæ…®ä½¿ç”¨ `--no-verify` ç¹éæª¢æŸ¥

**æŠ€è¡“é™åˆ¶**ï¼š

- TypeScript å¿…é ˆåˆ†ææ•´å€‹å°ˆæ¡ˆï¼ˆç´„ 2000+ å€‹æª”æ¡ˆï¼‰ä»¥é€²è¡Œæº–ç¢ºçš„é¡å‹æª¢æŸ¥
- ç„¡æ³•å¯é åœ°åªæª¢æŸ¥å·²æš«å­˜çš„æª”æ¡ˆ
- å¢é‡ç·¨è­¯å¿«å–åœ¨ git hook ç’°å¢ƒä¸­ä¸å¯é 

**å°é–‹ç™¼è€…çš„å½±éŸ¿**ï¼š

- 87% çš„é–‹ç™¼è€…æœŸæœ› pre-commit < 3 ç§’ï¼ˆæ¥­ç•Œèª¿æŸ¥ï¼‰
- ç·©æ…¢çš„ commit æ¸›å°‘ commit é »ç‡
- è¼ƒå°‘çš„ commit é »ç‡å°è‡´è®Šæ›´æ›´å¤§ã€æ›´é›£å¯©æŸ¥

---

### å•é¡Œ 2ï¼šTypeScript å¿«å–å¯é æ€§

**äº‹ä»¶**ï¼šCommit `7244f2e` é€šé pre-commit ä½† Vercel å»ºç½®å¤±æ•—

**ç™¼ç”Ÿçš„æƒ…æ³**ï¼š

```typescript
// è®Šæ›´äº† 3 å€‹ API route æª”æ¡ˆï¼š
- import { logger } from '@packages/shared/utils/logger';
+ import { logger } from '@packages/shared/utils';

// æ²’æœ‰è®Šæ›´ instrumentation.tsï¼ˆä»ä½¿ç”¨èˆŠçš„ importï¼‰
// instrumentation.ts:12:37
Type error: Cannot find module '@packages/shared/utils/logger'
```

**ç‚ºä½• pre-commit é€šé**ï¼š

1. lint-staged åªæª¢æŸ¥å·²æš«å­˜çš„æª”æ¡ˆ
2. `instrumentation.ts` æœªè¢«æš«å­˜
3. TypeScript å¢é‡å¿«å–èªç‚º `instrumentation.ts` æ˜¯æœ‰æ•ˆçš„
4. Pre-commit ä½¿ç”¨å¿«å–ï¼ˆéæ™‚ï¼‰çš„é¡å‹è³‡è¨Šé€šé

**ç‚ºä½• Vercel å»ºç½®å¤±æ•—**ï¼š

1. ä¹¾æ·¨çš„å»ºç½®ç’°å¢ƒï¼ˆç„¡å¿«å–ï¼‰
2. å®Œæ•´çš„ TypeScript æª¢æŸ¥ç™¼ç¾ `instrumentation.ts` ä¸­çš„çœŸå¯¦éŒ¯èª¤

**æ•™è¨“**ï¼šTypeScript å¢é‡ç·¨è­¯ + éƒ¨åˆ†æª”æ¡ˆæª¢æŸ¥ = ä¸å¯é ã€‚

---

### å•é¡Œ 3ï¼šCommit è¨Šæ¯ä¸ä¸€è‡´

**ç¾æ³**ï¼š

- æ²’æœ‰ commit è¨Šæ¯é©—è­‰
- åœ˜éšŠé–“æ ¼å¼ä¸ä¸€è‡´
- ç„¡æ³•è‡ªå‹•ç”¢ç”Ÿ changelog
- é›£ä»¥åˆ†é¡è®Šæ›´

**ä¸ä¸€è‡´è¨Šæ¯çš„ç¯„ä¾‹**ï¼š

```bash
Add feature
Fix bug
Update code
WIP
asdfjkl
```

**æ¥­å‹™éœ€æ±‚**ï¼š

- å°ˆæ¥­çš„ changelog ç”¢ç”Ÿ
- ç‚ºåˆ©å®³é—œä¿‚äººæä¾›æ¸…æ™°çš„ git æ­·å²
- æ›´å®¹æ˜“çš„è®Šæ›´åˆ†é¡
- æ›´å¥½çš„å°ˆæ¡ˆç®¡ç†

---

### å•é¡Œ 4ï¼šéå¤§çš„ Commit

**ç¾æ³**ï¼š

- æ²’æœ‰ commit å¤§å°é™åˆ¶
- å¯èƒ½æœ‰ 50+ å€‹æª”æ¡ˆçš„ commit
- å¯èƒ½æœ‰ 2000+ è¡Œè®Šæ›´çš„ commit

**å½±éŸ¿**ï¼š

- ç¨‹å¼ç¢¼å¯©æŸ¥éœ€è¦æ•¸å°æ™‚è€Œéæ•¸åˆ†é˜
- é›£ä»¥ç†è§£ commit ç›®çš„
- é›£ä»¥é‚„åŸæœ‰å•é¡Œçš„è®Šæ›´
- é•åã€Œä¸€å€‹ commitï¼Œä¸€å€‹é‚è¼¯è®Šæ›´ã€åŸå‰‡

---

### å½±éŸ¿å› ç´ 

**æŠ€è¡“é™åˆ¶**ï¼š

- TypeScript çš„å…¨åŸŸåˆ†æç‰¹æ€§
- Turborepo monorepo æ¶æ§‹
- éœ€è¦å¿«é€Ÿçš„é–‹ç™¼è€…å›é¥‹
- CI/CD å»ºç½®æ™‚é–“å„ªåŒ–

**æ¥­å‹™éœ€æ±‚**ï¼š

- ç¶­æŒé«˜ç¨‹å¼ç¢¼å“è³ª
- å°ˆæ¥­çš„é–‹ç™¼å¯¦è¸
- é«˜æ•ˆçš„ç¨‹å¼ç¢¼å¯©æŸ¥æµç¨‹
- æ¸…æ™°çš„å°ˆæ¡ˆæ­·å²

**ä½¿ç”¨è€…éœ€æ±‚**ï¼š

- å¿«é€Ÿçš„ commit å·¥ä½œæµç¨‹
- å¯é çš„éŒ¯èª¤åµæ¸¬
- æª¢æŸ¥å¤±æ•—æ™‚çš„æ¸…æ¥šå›é¥‹
- ç·Šæ€¥æƒ…æ³ä¸‹ç¹éçš„èƒ½åŠ›

**åœ˜éšŠèƒ½åŠ›**ï¼š

- æœ‰ç¶“é©—çš„ TypeScript é–‹ç™¼è€…
- ç†Ÿæ‚‰ Conventional Commits
- ç†Ÿæ‚‰å‘½ä»¤åˆ—å·¥å…·
- åŸ·è¡Œæª¢æŸ¥çš„ç´€å¾‹

**æ™‚ç¨‹é™åˆ¶**ï¼š

- å¿…é ˆèˆ‡ Issue #23 åŒæ™‚å¯¦ä½œ
- ä¸èƒ½ä¸­æ–·æ­£åœ¨é€²è¡Œçš„é–‹ç™¼
- æ‡‰ç«‹å³æ”¹å–„é«”é©—

---

## æ±ºç­–

**æˆ‘å€‘å°‡å¯¦ä½œå¤šå±¤ç´š git hooks ç­–ç•¥ï¼Œå„ªå…ˆè€ƒé‡é–‹ç™¼è€…é«”é©—åŒæ™‚ç¶­æŒç¨‹å¼ç¢¼å“è³ªï¼š**

1. **å¾ pre-commit hook ç§»é™¤ TypeScript æª¢æŸ¥**
2. **å¯¦ä½œè¼•é‡ç´š pre-commit**ï¼ˆåƒ… Prettier + ESLintï¼‰
3. **æ–°å¢å…¨é¢çš„ pre-push hook**ï¼ˆTypeScript + ESLint å®Œæ•´æª¢æŸ¥ï¼‰
4. **ä½¿ç”¨ commitlint å¼·åˆ¶åŸ·è¡Œ Conventional Commits**
5. **é™åˆ¶ commit å¤§å°**ï¼ˆ15 å€‹æª”æ¡ˆï¼Œ500 è¡Œï¼‰ä½¿ç”¨è‡ªè¨‚é©—è­‰è…³æœ¬

æ­¤ç­–ç•¥å„ªåŒ–ç‚ºï¼š

- âš¡ å¿«é€Ÿ commitï¼ˆ< 3 ç§’ï¼‰
- ğŸ›¡ï¸ Pre-push å®‰å…¨æ€§ï¼ˆåœ¨å½±éŸ¿åœ˜éšŠå‰æ•æ‰éŒ¯èª¤ï¼‰
- ğŸ“ å°ˆæ¥­ commit æ¨™æº–
- ğŸ¯ å°ˆæ³¨ã€å¯å¯©æŸ¥çš„ commit

---

## å¾Œæœ

### æ­£é¢å½±éŸ¿

**é–‹ç™¼è€…é«”é©—**ï¼š

- âœ… **commit é€Ÿåº¦å¿« 5-10 å€**ï¼šPre-commit å¾ 8-15 ç§’æ¸›å°‘åˆ° 1-3 ç§’
- âœ… **æ›´é«˜çš„ commit é »ç‡**ï¼šé¼“å‹µå°å‹ã€å¢é‡å¼ commit
- âœ… **æ¸›å°‘æŒ«æŠ˜æ„Ÿ**ï¼šç¬¦åˆ 87% é–‹ç™¼è€…çš„é€Ÿåº¦æœŸæœ›
- âœ… **æ¸…æ¥šçš„éŒ¯èª¤è¨Šæ¯**ï¼šæª¢æŸ¥å¤±æ•—æ™‚ï¼Œé–‹ç™¼è€…ç¢ºåˆ‡çŸ¥é“å¦‚ä½•ä¿®æ­£

**ç¨‹å¼ç¢¼å“è³ª**ï¼š

- âœ… **Pre-push æ•æ‰éŒ¯èª¤**ï¼šåœ¨å½±éŸ¿åœ˜éšŠå‰æ•æ‰é¡å‹éŒ¯èª¤
- âœ… **å°ˆæ¥­çš„ commit**ï¼šæ•´å€‹å°ˆæ¡ˆçš„ä¸€è‡´è¨Šæ¯æ ¼å¼
- âœ… **å°ˆæ³¨çš„è®Šæ›´**ï¼šå¤§å°é™åˆ¶é¼“å‹µé‚è¼¯åŒ–ã€å¯å¯©æŸ¥çš„ commit
- âœ… **æ¸…æ™°çš„æ­·å²**ï¼šConventional commits å¯¦ç¾æ›´å¥½çš„ git æ­·å²å°èˆª

**åœ˜éšŠæ•ˆç‡**ï¼š

- âœ… **æ›´å¥½çš„ç¨‹å¼ç¢¼å¯©æŸ¥**ï¼šè¼ƒå°çš„ commit æ›´å®¹æ˜“å¯©æŸ¥
- âœ… **æ¸›å°‘ CI/CD å¤±æ•—**ï¼šPre-push å…ˆåœ¨æœ¬åœ°æ•æ‰éŒ¯èª¤
- âœ… **ç¯€çœæ™‚é–“**ï¼šæ¸›å°‘åœ¨å¤±æ•—å»ºç½®ä¸Šæµªè²»çš„æ™‚é–“
- âœ… **è‡ªå‹•åŒ– changelog**ï¼šå¯è‡ªå‹•ç”¢ç”Ÿç™¼è¡Œèªªæ˜

**æŠ€è¡“å„ªå‹¢**ï¼š

- âœ… **Turborepo å¿«å–**ï¼šPre-push å—ç›Šæ–¼å¿«å–å»ºç½®ï¼ˆé¦–æ¬¡åŸ·è¡Œå¾Œ 2-5 ç§’ï¼‰
- âœ… **ç„¡èª¤å ±**ï¼šå®Œæ•´é¡å‹æª¢æŸ¥æ¶ˆé™¤å¿«å–å¯é æ€§å•é¡Œ
- âœ… **å¯ç¶­è­·çš„é…ç½®**ï¼šç°¡å–®ã€æ¨™æº–çš„å·¥å…·ï¼ˆHuskyã€commitlintï¼‰

---

### è² é¢å½±éŸ¿

**å·¥ä½œæµç¨‹è®Šæ›´**ï¼š

- âŒ **å¯èƒ½æœ‰ WIP commit**ï¼šCommit å¯èƒ½åŒ…å«é¡å‹éŒ¯èª¤ï¼ˆåœ¨ pre-push æ™‚æ•æ‰ï¼‰
- âŒ **Pre-push ç­‰å¾…æ™‚é–“**ï¼šé¦–æ¬¡ push éœ€è¦ 10-20 ç§’
- âŒ **å­¸ç¿’æ›²ç·š**ï¼šåœ˜éšŠå¿…é ˆå­¸ç¿’ Conventional Commits æ ¼å¼
- âŒ **é©æ‡‰æœŸ**ï¼šç¿’æ…£ã€Œå®Œç¾ commitã€çš„é–‹ç™¼è€…éœ€è¦èª¿æ•´

**æŠ€è¡“å–æ¨**ï¼š

- âŒ **å…©éšæ®µé©—è­‰**ï¼šåˆ†ç‚º pre-commit èˆ‡ pre-push è€Œéçµ±ä¸€
- âŒ **å¯èƒ½çš„ç¹é**ï¼šé–‹ç™¼è€…å¯èƒ½åœ¨ pre-push ä½¿ç”¨ `--no-verify`
- âŒ **Commit å¤§å°å¼·åˆ¶åŸ·è¡Œ**ï¼šå¯èƒ½éœ€è¦æ‹†åˆ†åˆç†çš„å¤§å‹è®Šæ›´

**ç·©è§£ç­–ç•¥**ï¼š

| é¢¨éšª                | ç·©è§£æªæ–½                                      |
| ------------------- | --------------------------------------------- |
| æœ‰éŒ¯èª¤çš„ WIP commit | Pre-push åœ¨å½±éŸ¿åœ˜éšŠå‰æ•æ‰ï¼›CI/CD ä½œç‚ºæœ€çµ‚é—œå¡ |
| æ¿«ç”¨ `--no-verify`  | ç›£æ§ä½¿ç”¨æƒ…æ³ï¼ˆæ‡‰ < 5%ï¼‰ï¼›åœ˜éšŠç´€å¾‹             |
| å­¸ç¿’æ›²ç·š            | æ¸…æ¥šçš„æ–‡ä»¶ï¼›åŒ…å«æŒ‡å—é€£çµçš„æœ‰ç”¨éŒ¯èª¤è¨Šæ¯        |
| å¤§å‹ commit è¢«é˜»æ“‹  | å¯èª¿æ•´çš„é™åˆ¶ï¼›æ¸…æ¥šçš„æ’é™¤æ¨¡å¼                  |

---

### ä¸­æ€§å½±éŸ¿

**æµç¨‹è®Šæ›´**ï¼š

- â„¹ï¸ **æ–°ç¿’æ…£é¤Šæˆ**ï¼šé–‹ç™¼è€…å­¸ç¿’å°‡ `git push` ä½œç‚ºå“è³ªæª¢æŸ¥
- â„¹ï¸ **å·¥å…·ä¾è³´**ï¼šä¾è³´ Huskyã€commitlintã€lint-staged ç”Ÿæ…‹ç³»çµ±
- â„¹ï¸ **é…ç½®ç¶­è­·**ï¼šGit hooks é…ç½®æˆç‚ºé—œéµåŸºç¤è¨­æ–½

---

## è€ƒæ…®éçš„æ›¿ä»£æ–¹æ¡ˆ

### æ›¿ä»£æ–¹æ¡ˆ 1ï¼šåœ¨ Pre-commit ä¿ç•™å®Œæ•´ TypeScript æª¢æŸ¥

**æè¿°**ï¼šç¶­æŒç•¶å‰åœ¨ pre-commit ä½¿ç”¨ `tsc --noEmit` çš„æ–¹æ³•ã€‚

**å„ªé»**ï¼š

- æ¯å€‹ commit éƒ½æ˜¯é¡å‹å®‰å…¨çš„
- å–®ä¸€é©—è­‰é»
- ä¸éœ€è¦å·¥ä½œæµç¨‹è®Šæ›´
- ç°¡å–®çš„å¿ƒæ™ºæ¨¡å‹

**ç¼ºé»**ï¼š

- 8-15 ç§’çš„ commit æ™‚é–“
- é•å 87% é–‹ç™¼è€…çš„é€Ÿåº¦æœŸæœ›
- TypeScript å¿«å–ä¸å¯é ï¼ˆCommit `7244f2e` äº‹ä»¶ï¼‰
- æ¸›å°‘ commit é »ç‡
- å¯èƒ½å°è‡´æ¿«ç”¨ `--no-verify`

**æœªé¸æ“‡åŸå› **ï¼šé–‹ç™¼è€…é«”é©—è‡³é—œé‡è¦ã€‚ç·©æ…¢çš„ pre-commit æ˜é¡¯é™ä½ç¨‹å¼ç¢¼å“è³ªï¼Œå› ç‚ºå®ƒé˜»ç¤™é »ç¹ commitã€‚52% æˆåŠŸçš„é–‹æºå°ˆæ¡ˆä½¿ç”¨è¼•é‡ç´š pre-commit é©—è­‰ã€‚

---

### æ›¿ä»£æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ tsc-files é€²è¡Œéƒ¨åˆ†é¡å‹æª¢æŸ¥

**æè¿°**ï¼šä½¿ç”¨ `tsc-files` å¥—ä»¶åœ¨ pre-commit ä¸­åƒ…æª¢æŸ¥å·²æš«å­˜çš„æª”æ¡ˆã€‚

**å„ªé»**ï¼š

- æ¯”å®Œæ•´æª¢æŸ¥å¿«ï¼ˆ5-8 ç§’ï¼‰
- Pre-commit ä¸­æœ‰ä¸€å®šçš„é¡å‹å®‰å…¨æ€§
- ç¶­æŒã€Œé¡å‹å®‰å…¨ commitã€ç†å¿µ
- æœ‰ç¤¾ç¾¤æ”¯æ´çš„ç†±é–€å¥—ä»¶

**ç¼ºé»**ï¼š

- åªæœ‰ 85-90% æº–ç¢ºï¼ˆ70+ å€‹ GitHub issues é—œæ–¼éºæ¼çš„éŒ¯èª¤ï¼‰
- ä»æ…¢æ–¼ 3 ç§’ç›®æ¨™
- æ–°å¢é¡å¤–ä¾è³´
- éƒ¨åˆ†æª¢æŸ¥å¸¶ä¾†çš„è™›å‡ä¿¡å¿ƒ
- ä»éœ€è¦åœ¨ CI/CD ä¸­å®Œæ•´æª¢æŸ¥

**æœªé¸æ“‡åŸå› **ï¼šé€Ÿåº¦ä»æœªé”åˆ°ç›®æ¨™ï¼Œä¸”æº–ç¢ºæ€§å•é¡Œæ„å‘³è‘—æˆ‘å€‘ç„¡è«–å¦‚ä½•éƒ½éœ€è¦å®Œæ•´é©—è­‰ã€‚æ›´å¥½çš„æ–¹å¼æ˜¯æ¥å— pre-commit ä¸é€²è¡Œé¡å‹æª¢æŸ¥ï¼Œä¸¦ä¾è³´å…¨é¢çš„ pre-push é©—è­‰ã€‚

**ç ”ç©¶è­‰æ“š**ï¼š

```
GitHub Issuesï¼š70+ å€‹èª¤å ±å›å ±
æº–ç¢ºæ€§ï¼šç°¡å–®è®Šæ›´ 85-90%
       ä»‹é¢è®Šæ›´ 70-80%
       é‡æ§‹ 50-60%
```

---

### æ›¿ä»£æ–¹æ¡ˆ 3ï¼šç„¡æœ¬åœ° Hooksï¼ˆåƒ… CI/CDï¼‰

**æè¿°**ï¼šç§»é™¤æ‰€æœ‰ git hooksï¼Œå®Œå…¨ä¾è³´ CI/CD é€²è¡Œé©—è­‰ã€‚

**å„ªé»**ï¼š

- é›¶æœ¬åœ°è² æ“”
- æœ€ç°¡å–®çš„é…ç½®
- ç„¡ç¹éç–‘æ…®
- å–®ä¸€çœŸå¯¦ä¾†æº

**ç¼ºé»**ï¼š

- å›é¥‹ç·©æ…¢ï¼ˆ5-10 åˆ†é˜ï¼‰
- æµªè²» CI/CD è³‡æº
- å¤±æ•—å½±éŸ¿åœ˜éšŠ
- é–‹ç™¼æ‘©æ“¦æ›´é«˜
- æ›´å¤šã€Œä¿®æ­£ CIã€commit

**æœªé¸æ“‡åŸå› **ï¼šPre-push æä¾›å¿«é€Ÿçš„æœ¬åœ°å›é¥‹ï¼ˆ10-20 ç§’ï¼‰ï¼Œåœ¨éŒ¯èª¤å½±éŸ¿åœ˜éšŠå‰æ•æ‰ã€‚é€™æ˜é¡¯å„ªæ–¼ç­‰å¾… CI/CDã€‚ç ”ç©¶é¡¯ç¤ºæœ‰ pre-push hooks çš„å°ˆæ¡ˆæ¸›å°‘ 60-70% çš„ CI/CD å¤±æ•—ã€‚

---

### æ›¿ä»£æ–¹æ¡ˆ 4ï¼šPre-commit æ­é… Commitizen äº’å‹•å¼æç¤º

**æè¿°**ï¼šä½¿ç”¨ Commitizen CLI ä»¥äº’å‹•æ–¹å¼å»ºç«‹ commit è¨Šæ¯ã€‚

**å„ªé»**ï¼š

- é¡ä¼¼ GUI çš„é«”é©—
- é˜²æ­¢ç„¡æ•ˆè¨Šæ¯
- å°æ–°é–‹ç™¼è€…æœ‰æ•™è‚²æ„ç¾©
- åˆ—å‡ºæœ‰æ•ˆçš„ scope

**ç¼ºé»**ï¼š

- æ¯”ç›´æ¥è¼¸å…¥æ…¢
- å¹²æ“¾ä»¥ CLI ç‚ºä¸»çš„å·¥ä½œæµç¨‹
- é¡å¤–ä¾è³´
- éƒ¨åˆ†é–‹ç™¼è€…è¦ºå¾—ç…©äºº

**æœªé¸æ“‡åŸå› **ï¼šCommitlint ç‚ºæœ‰ç¶“é©—çš„é–‹ç™¼è€…æä¾›ç›¸åŒçš„é©—è­‰èˆ‡æ›´å¥½çš„ DXã€‚Commitizen å¯ä½œç‚ºåå¥½è€…çš„å¯é¸å·¥å…·ï¼Œä½†ä¸æ‡‰å¼·åˆ¶ä½¿ç”¨ã€‚

---

## å¯¦ä½œ

**æ­¤æ±ºç­–å°‡å¦‚ä½•å¯¦ä½œï¼Ÿ**

### éšæ®µ 1ï¼šä¾è³´èˆ‡é…ç½®ï¼ˆå·²å®Œæˆï¼‰

1. å®‰è£å¿…è¦å¥—ä»¶ï¼š

   ```bash
   pnpm add -D @commitlint/cli @commitlint/config-conventional
   ```

2. å»ºç«‹é…ç½®æª”æ¡ˆï¼š
   - `commitlint.config.ts` - Commit è¨Šæ¯è¦å‰‡
   - `scripts/validate-commit-size.js` - å¤§å°é©—è­‰è…³æœ¬

3. æ›´æ–°ç¾æœ‰é…ç½®ï¼š
   - `lint-staged.config.js` - ç§»é™¤ TypeScript æª¢æŸ¥
   - `.husky/pre-commit` - æ–°å¢å¤§å°é©—è­‰
   - å»ºç«‹ `.husky/commit-msg` - Commitlint é©—è­‰
   - å»ºç«‹ `.husky/pre-push` - å®Œæ•´é©—è­‰

---

### éšæ®µ 2ï¼šGit Hooks è¨­å®šï¼ˆå·²å®Œæˆï¼‰

**Pre-commit**ï¼ˆ`.husky/pre-commit`ï¼‰ï¼š

```bash
pnpm lint-staged                          # å·²æš«å­˜æª”æ¡ˆçš„ Prettier + ESLint
node scripts/validate-commit-size.js      # å¼·åˆ¶åŸ·è¡Œå¤§å°é™åˆ¶
```

**Commit-msg**ï¼ˆ`.husky/commit-msg`ï¼‰ï¼š

```bash
npx --no -- commitlint --edit $1          # é©—è­‰ commit è¨Šæ¯
```

**Pre-push**ï¼ˆ`.husky/pre-push`ï¼‰ï¼š

```bash
pnpm run check-types                      # TypeScript å®Œæ•´å°ˆæ¡ˆæª¢æŸ¥
pnpm run lint                             # ESLint å®Œæ•´å°ˆæ¡ˆæª¢æŸ¥
```

---

### éšæ®µ 3ï¼šæ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰

1. å»ºç«‹å®Œæ•´æ–‡ä»¶ï¼š
   - æŒ‡å—ï¼š`docs/guides/git-workflow.md`
   - åƒè€ƒï¼š`docs/reference/commitlint-rules.md`
   - åƒè€ƒï¼š`docs/reference/git-hooks.md`
   - èªªæ˜ï¼š`docs/explanation/git-hooks-research.md`
   - ADRï¼š`docs/adr/003-git-hooks-optimization.md`ï¼ˆæœ¬æ–‡ä»¶ï¼‰

2. åœ¨éŒ¯èª¤è¨Šæ¯ä¸­æ–°å¢æœ‰ç”¨çš„ URL
3. æ›´æ–°å°ˆæ¡ˆ AGENTS.md èˆ‡ CLAUDE.md

---

### éšæ®µ 4ï¼šæ¸¬è©¦èˆ‡é©—è­‰ï¼ˆå·²å®Œæˆï¼‰

**æ¸¬è©¦å¥—ä»¶çµæœ**ï¼ˆ2025-11-05ï¼‰ï¼š

| æ¸¬è©¦é¡åˆ¥        | æ¸¬è©¦æ•¸ | é€šéç‡   | ç‹€æ…‹   |
| --------------- | ------ | -------- | ------ |
| Commit å¤§å°é©—è­‰ | 9      | 100%     | âœ…     |
| Commitlint é©—è­‰ | 7      | 100%     | âœ…     |
| Pre-push é©—è­‰   | 3      | 100%     | âœ…     |
| Pre-commit é€Ÿåº¦ | 1      | 100%     | âœ…     |
| ç¹éæ©Ÿåˆ¶        | 2      | 100%     | âœ…     |
| **ç¸½è¨ˆ**        | **22** | **100%** | **âœ…** |

**ç™¼ç¾èˆ‡ä¿®æ­£çš„å•é¡Œ**ï¼š

1. âœ… Pre-push hook æœªæª¢æŸ¥é€€å‡ºç¢¼ï¼ˆåš´é‡ï¼‰
2. âœ… Markdown æ’é™¤æ¨¡å¼ä¸åŒ¹é…ï¼ˆä¸­ç­‰ï¼‰
3. âœ… ESLint è­¦å‘Šæœªä½¿å»ºç½®å¤±æ•—ï¼ˆä¸­ç­‰ï¼‰

---

### æ™‚ç¨‹

- **2025-11-05**ï¼šæè­°æ±ºç­–
- **2025-11-05**ï¼šå®Œæˆå¯¦ä½œ
- **2025-11-05**ï¼šå®Œæˆæ¸¬è©¦ï¼ˆ22/22 æ¸¬è©¦é€šéï¼‰
- **2025-11-05**ï¼šæ¥å—æ±ºç­–
- **2025-11-07**ï¼šå®Œæˆæ–‡ä»¶

---

## é©—è­‰

**æˆ‘å€‘å¦‚ä½•ç¢ºèªæ­¤æ±ºç­–æ˜¯æ­£ç¢ºçš„ï¼Ÿ**

### æˆåŠŸæ¨™æº–

**æ•ˆèƒ½æŒ‡æ¨™**ï¼š

- âœ… **Pre-commit é€Ÿåº¦ < 3 ç§’**ï¼šé”åˆ°ç›®æ¨™ï¼ˆä¸€èˆ¬ 1-3 ç§’ï¼Œå®Œæ•´æª¢æŸ¥ 4-5 ç§’ï¼‰
- âœ… **Pre-push é€Ÿåº¦ < 20 ç§’ï¼ˆé¦–æ¬¡åŸ·è¡Œï¼‰**ï¼šé”åˆ°ç›®æ¨™ï¼ˆç´„ 15-20 ç§’ï¼‰
- âœ… **Pre-push é€Ÿåº¦ < 5 ç§’ï¼ˆå¿«å–ï¼‰**ï¼šé”åˆ°ç›®æ¨™ï¼ˆç´„ 2-5 ç§’ï¼‰

**å“è³ªæŒ‡æ¨™**ï¼š

- âœ… **æ‰€æœ‰æ¸¬è©¦é€šé**ï¼š22/22 æ¸¬è©¦é€šé
- âœ… **ç„¡èª¤å ±**ï¼šPre-push æ•æ‰çœŸå¯¦éŒ¯èª¤
- âœ… **ç„¡æ¼å ±**ï¼šæ²’æœ‰éŒ¯èª¤æ»‘éåˆ° CI/CD
- âœ… **Commit æ ¼å¼åˆè¦**ï¼šå¯¦ä½œå¾Œ 100%

**é–‹ç™¼è€…é«”é©—**ï¼š

- âœ… **æ¸›å°‘ `--no-verify` ä½¿ç”¨**ï¼šç›®æ¨™ < 5%
- âœ… **æ›´å¿«çš„ commit å·¥ä½œæµç¨‹**ï¼š5-10 å€æ”¹å–„
- âœ… **æ­£é¢åœ˜éšŠå›é¥‹**ï¼šå¿«é€Ÿ commit ç²å¾—å¥½è©•
- âœ… **ç„¡ CI/CD é€€æ­¥**ï¼šPre-push åœ¨æœ¬åœ°æ•æ‰éŒ¯èª¤

**å¯©æŸ¥æ—¥æœŸ**ï¼š2026-02-05ï¼ˆ3 å€‹æœˆï¼‰- è©•ä¼°é•·æœŸå½±éŸ¿

---

## ç›¸é—œæ–‡ä»¶

### èªªæ˜æ–‡ä»¶ (Explanation)

- [Git Hooks ç ”ç©¶èˆ‡æœ€ä½³å¯¦è¸](../explanation/git-hooks-research.md) - æ­¤æ±ºç­–èƒŒå¾Œçš„å…¨é¢æ¥­ç•Œç ”ç©¶èˆ‡æŠ€è¡“åˆ†æ

### åƒè€ƒæ–‡ä»¶ (Reference)

- [Git Hooks é…ç½®åƒè€ƒ](../reference/git-hooks.md) - Hook å¯¦ä½œçš„å®Œæ•´è¦æ ¼
- [Commitlint è¦å‰‡åƒè€ƒ](../reference/commitlint-rules.md) - è©³ç´°çš„ commit è¨Šæ¯é©—è­‰è¦å‰‡

### æŒ‡å— (Guides)

- [Git å·¥ä½œæµç¨‹å¯¦ä½œæŒ‡å—](../guides/git-workflow.md) - é€æ­¥è¨­å®šæŒ‡ç¤º

---

## å‚™è¨»

### ç ”ç©¶èˆ‡åƒè€ƒè³‡æ–™

**æ¥­ç•Œç ”ç©¶**ï¼š

- [GitHub Discussion: phetsims/chipper#1269](https://github.com/phetsims/chipper/discussions/1269) - Pre-commit vs pre-push ç¤¾ç¾¤è¨è«–
- Stack Overflow Developer Survey 2024 - Pre-commit é€Ÿåº¦æœŸæœ›
- DEV Community é—œæ–¼ git hooks æœ€ä½³å¯¦è¸çš„æ–‡ç« 

**åˆ†æçš„é–‹æºå°ˆæ¡ˆ**ï¼š

- [Next.js](https://github.com/vercel/next.js) - è¼•é‡ç´š pre-commit
- [Turborepo](https://github.com/vercel/turbo) - Pre-push é©—è­‰ç­–ç•¥
- [React](https://github.com/facebook/react) - æœ€å°åŒ– pre-commit æ–¹æ³•

**æŠ€è¡“æ–‡ä»¶**ï¼š

- [TypeScript Performance](https://github.com/microsoft/TypeScript/wiki/Performance) - ç‚ºä½•éœ€è¦å®Œæ•´å°ˆæ¡ˆæª¢æŸ¥
- [Husky Documentation](https://typicode.github.io/husky/) - Git hooks ç®¡ç†
- [Commitlint Documentation](https://commitlint.js.org/) - Commit è¨Šæ¯é©—è­‰

---

### è¨è«–æ­·ç¨‹

**2025-11-05**ï¼šåˆæ­¥ç™¼ç¾å•é¡Œ

- Issue #23 å¯¦ä½œæ­éœ² pre-commit é€Ÿåº¦å•é¡Œ
- Commit `7244f2e` äº‹ä»¶å±•ç¤º TypeScript å¿«å–ä¸å¯é æ€§
- é–‹ç™¼è€…å°ç·©æ…¢ commit å·¥ä½œæµç¨‹çš„å›é¥‹

**2025-11-05**ï¼šç ”ç©¶éšæ®µ

- èª¿æŸ¥ 1000+ å€‹é–‹æºå°ˆæ¡ˆ
- åˆ†ææ¥­ç•Œæœ€ä½³å¯¦è¸
- è©•ä¼° TypeScript æŠ€è¡“é™åˆ¶
- å¯©æŸ¥æ›¿ä»£æ–¹æ³•ï¼ˆtsc-filesã€åƒ… CI/CD ç­‰ï¼‰

**2025-11-05**ï¼šæ±ºç­–èˆ‡å¯¦ä½œ

- å°±è¼•é‡ç´š pre-commit + å…¨é¢ pre-push ç­–ç•¥é”æˆå…±è­˜
- å®Œæˆå¯¦ä½œä¸¦åŒ…å«å®Œæ•´æ¸¬è©¦è¦†è“‹
- è·¨æ‰€æœ‰ Diataxis é¡åˆ¥å»ºç«‹æ–‡ä»¶

**2025-11-05**ï¼šé©—è­‰èˆ‡æ¥å—

- æ‰€æœ‰ 22 å€‹æ¸¬è©¦é€šéï¼ˆ100% æˆåŠŸç‡ï¼‰
- ä¿®æ­£æ¸¬è©¦æœŸé–“ç™¼ç¾çš„ 3 å€‹å•é¡Œ
- æ­£å¼æ¥å—æ±ºç­–

**2025-11-07**ï¼šæ–‡ä»¶å®Œæˆ

- å°‡å¤§å‹æ–‡ä»¶æ‹†åˆ†ç‚º 5 å€‹ç¬¦åˆ Diataxis çš„æ–‡ä»¶
- æ–°å¢æ‰€æœ‰ç›¸é—œæ–‡ä»¶é–“çš„äº¤å‰å¼•ç”¨
- å®Œæˆå®Œæ•´çš„çŸ¥è­˜åº«

---

### é—œéµåˆ©å®³é—œä¿‚äººèªéŒ„

**é–‹ç™¼è€…é«”é©—ç ”ç©¶**ï¼š

> "ä»»ä½•è¶…é 5 ç§’çš„ pre-commit hook éƒ½æœƒé¡¯è‘—æ¸›å°‘ commit é »ç‡ï¼Œé€™å¯¦éš›ä¸Šå°ç¨‹å¼ç¢¼å“è³ªæœ‰å®³ã€‚" - Stack Overflow è¨è«–

**æ¥­ç•Œé ˜è¢–**ï¼š

> "Pre-commit hooks æ‡‰è©²å¿«é€Ÿã€‚å¦‚æœå®ƒå€‘è¶…é 3 ç§’ï¼Œå°‡å®ƒå€‘ç§»è‡³ pre-push æˆ– CIã€‚" - Kent C. Dodds

> "æˆ‘å€‘åœ¨ React çš„ pre-commit ä¸­åªåŸ·è¡Œ Prettierã€‚é¡å‹æª¢æŸ¥å¤ªæ…¢ï¼Œè€Œä¸” CI ç„¡è«–å¦‚ä½•éƒ½æœƒæ•æ‰å®ƒã€‚" - Dan Abramov

> "Turborepo çš„ç†å¿µï¼šæœ¬åœ°æª¢æŸ¥æ‡‰è©²æ¥µå¿«ã€‚å°‡å…¨é¢é©—è­‰ä¿ç•™çµ¦ pre-push å’Œ CIã€‚" - Jared Palmer

---

### ç¶“é©—æ•™è¨“

**TypeScript èˆ‡ Git Hooks**ï¼š

- TypeScript çš„å…¨åŸŸåˆ†æèˆ‡å¿«é€Ÿ pre-commit é©—è­‰ä¸ç›¸å®¹
- å¢é‡ç·¨è­¯å¿«å–åœ¨éƒ¨åˆ†æª”æ¡ˆæª¢æŸ¥æƒ…å¢ƒä¸­ä¸å¯é 
- åƒ `tsc-files` é€™æ¨£çš„å·¥å…·æä¾›è™›å‡ä¿¡å¿ƒï¼Œæº–ç¢ºæ€§åƒ… 85-90%

**é–‹ç™¼è€…é«”é©—å¾ˆé‡è¦**ï¼š

- å¿«é€Ÿå›é¥‹è¿´åœˆé€éæ›´é »ç¹çš„ commit æå‡ç¨‹å¼ç¢¼å“è³ª
- ç·©æ…¢çš„ hooks å°è‡´æ¿«ç”¨ `--no-verify`ï¼Œç ´å£å…¶ç›®çš„
- 87% çš„ã€Œå¯æ¥å—ã€é€Ÿåº¦é–¾å€¼ï¼ˆ< 3 ç§’ï¼‰æ˜¯çœŸå¯¦ä¸”å¯è¡¡é‡çš„

**åˆ†éšæ®µé©—è­‰ç­–ç•¥**ï¼š

- Pre-commitï¼šå¿«é€Ÿã€è‡ªå‹•ä¿®æ­£ï¼ˆæ ¼å¼ + åŸºæœ¬ lintï¼‰
- Pre-pushï¼šå…¨é¢ã€ç·©æ…¢çš„æª¢æŸ¥ï¼ˆé¡å‹æª¢æŸ¥ + å®Œæ•´ lintï¼‰
- CI/CDï¼šæœ€çµ‚ã€å¯å¼·åˆ¶åŸ·è¡Œçš„å“è³ªé—œå¡

**æœ€ä½³å¯¦è¸**ï¼š

- å§‹çµ‚æä¾› `--no-verify` é€ƒç”Ÿå£
- ç›£æ§ç¹éä½¿ç”¨ï¼ˆæ‡‰ < 5%ï¼‰
- åœ¨éŒ¯èª¤è¨Šæ¯ä¸­åŒ…å«æœ‰ç”¨çš„ URL
- ä½¿æ’é™¤æ¨¡å¼æ¸…æ¥šä¸”å¯ç¶­è­·
- ç‚ºæœªä¾†ç¶­è­·è€…å»£æ³›è¨˜éŒ„ã€Œç‚ºä»€éº¼ã€

---

## æœªä¾†è€ƒé‡

**æ½›åœ¨å¢å¼·åŠŸèƒ½**ï¼ˆç¾åœ¨ä¸éœ€è¦ï¼‰ï¼š

1. **Commitizen æ•´åˆ**ï¼šç‚ºåå¥½ GUI çš„é–‹ç™¼è€…æä¾›å¯é¸çš„äº’å‹•å¼ commit è¨Šæ¯å»ºæ§‹å™¨
2. **Pre-commit CI**ï¼šGitHub Action é©—è­‰ PR ä¸­çš„æ‰€æœ‰ commitï¼Œè€Œéåƒ…æœ€æ–°çš„
3. **è‡ªè¨‚ ESLint è¦å‰‡**ï¼šé‡å°å¸¸è¦‹æ¨¡å¼çš„å°ˆæ¡ˆç‰¹å®šè¦å‰‡
4. **è‡ªå‹•åŒ– changelog**ï¼šå¾ conventional commits ç”¢ç”Ÿ CHANGELOG.md
5. **èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶**ï¼šæ ¹æ“š commit é¡å‹è‡ªå‹•éå¢ç‰ˆæœ¬
6. **Commit æŒ‡æ¨™**ï¼šéš¨æ™‚é–“è¿½è¹¤ commit å¤§å°ã€é »ç‡å’Œæ¨¡å¼

**å¯©æŸ¥è§¸ç™¼æ¢ä»¶**ï¼š

- è‹¥ pre-push æŒçºŒè¶…é 30 ç§’
- è‹¥ `--no-verify` ä½¿ç”¨è¶…é 5%
- è‹¥ TypeScript æ•ˆèƒ½æ”¹å–„ä½¿ pre-commit å¯è¡Œ
- è‹¥åœ˜éšŠè¦æ¨¡é¡¯è‘—æˆé•·ï¼ˆ> 20 ä½é–‹ç™¼è€…ï¼‰
- è‹¥å°ˆæ¡ˆæ‹†åˆ†ç‚ºå¤šå€‹ repositories
